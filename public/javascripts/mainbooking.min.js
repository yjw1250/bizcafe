function leadingZeros(n,digits){var zero='';n=n.toString();if(n.length<digits){for(i=0;i<digits-n.length;i++)zero+='0'}return zero+n}var _LISTS=5;var _PAGES=10;var _PAGE=1;$(document).ready(function(){var today=new Date();var current_hour=today.getHours();var current_min=today.getMinutes();$(function(){$.extend({bookpaging:function(thisPage,totalCnt){if(totalCnt<=0)return"";var listUnit=_LISTS;var pageUnit=_PAGES;var totPages=Math.ceil(totalCnt/listUnit);var thisBlock=Math.ceil(thisPage/pageUnit);var startPage,endPage;var preBlock,nextBlock;var html="";if(thisPage>1){preBlock=parseInt(thisPage,10)-1}else if(thisPage==1){preBlock=totPages}else{preBlock=thisPage}if(thisPage<totPages){nextBlock=parseInt(thisPage,10)+1}else if(thisPage==totPages){nextBlock=1}else{nextBlock=thisPage}html+="<span><a href=\"javascript:;\"><img src=\"public/images/main/btn_prev.gif\" alt=\"이전\" class='naviPage' pageNo='"+preBlock+"' /></a></span>";html+="<span><a href=\"javascript:;\"><img src=\"public/images/main/btn_next.gif\" alt=\"다음\" class='naviPage' pageNo='"+nextBlock+"' /></a></span>";html+="<span class=\"info\">공휴일은 운영하지 않습니다.</span>";return html},getReserver:function(date,page){$.ajax({type:"GET",url:"/booking/businessreserver"+".json",data:"resdate="+date,cache:false,async:true,dataType:"json",complete:function(XMLHttpRequest){},success:function(jsonData,textStatus,XMLHttpRequest){jsondata=jsonData;$.getRoomInfo("A",page)},error:function(xhr,ajaxOptions,thrownError){alert(thrownError);}})},getRoomInfo:function(roomCode01,page){if(!page)page=_PAGE;$.ajax({type:"GET",url:"/booking/businessallinfo"+".json",data:"page="+page+"&roomCode01="+roomCode01,cache:false,async:true,dataType:"json",complete:function(XMLHttpRequest){},success:function(jsonData,textStatus,XMLHttpRequest){sel_time=$("#resdate").val();$("#showdate").text(sel_time);var sel1=sel_time.split("-");var sel2=new Date(sel1[0],sel1[1]-1,sel1[2]);switch(sel2.getDay()){case 0:start_time=10;end_time=17;break;case 6:start_time=10;end_time=19;break;default:start_time=8;end_time=21;break}var addroom="";var room_name="";var room_name_max="";var roomcode="";for(var key in jsonData.roomlist){room_name=room_name+","+jsonData.roomlist[key].roomName04;room_name_max=room_name_max+","+jsonData.roomlist[key].roomName03;roomcode=roomcode+","+jsonData.roomlist[key].roomCode;room_cnt=jsonData.roomlist.length;room_title="";room_code=jsonData.roomlist[key].roomCode02;var g=parseInt(key)+1;var getroom_max=jsonData.roomlist[key].roomName03;if(key==0){addroom=getroom_max}else{if((g<jsonData.roomlist.length)&&(getroom_max!=jsonData.roomlist[g].roomName03)){addroom=addroom+","+jsonData.roomlist[g].roomName03}}}$("#mainbooking").html($.mainbooking(start_time,end_time,sel_time,room_cnt,room_title,roomcode,room_name,room_name_max,addroom,jsondata));$("#pageNavi").html($.bookpaging(page,jsonData.roomcount))},error:function(xhr,ajaxOptions,thrownError){alert(thrownError);}})},mainbooking:function(start_time,end_time,sel_time,room_cnt,room_title,roomcode,room_name,room_name_max,addroom,jsondata){var half_time_cnt=(end_time-start_time)+1;var currentday=new Date(today.getFullYear(),(today.getMonth()+1),today.getDate());var seldays=sel_time.split("-");var selday=new Date(seldays[0],seldays[1],seldays[2]);var maincontent;var subcontent;var footcontent;var timestr;var setclass="";var unchecknum=0;subcontent="<th class=\"divide\">Time</th>";for(var i=parseInt(start_time);i<=parseInt(end_time);i++){timestr=i.toString();if(timestr.length==1){timestr="0"+timestr}if(currentday.valueOf()==selday.valueOf()){if(timestr==current_hour){setclass="current"}else{setclass=""}}else{setclass=""}subcontent+="<th class="+setclass+">"+timestr+"</th>"}subcontent+="</thead>";subcontent+="</tr>";subcontent+="<tbody>";var roomnames;if(room_name.length>=1){roomnames=room_name.split(",")}var roomnames_maxs;if(room_name_max.length>=1){roomnames_maxs=room_name_max.split(",")}var roomcodes;if(roomcode.length>=1){roomcodes=roomcode.split(",")}var resdata="";for(var key in jsondata.reserver){if(jsondata.reserver[key].resDate==sel_time){resdata=resdata+","+jsondata.reserver[key].resRoom}}var resdatas=resdata.split(",");var restimes="";for(r=0;r<resdatas.length;r++){if(resdatas[r]){restimes=restimes+","+resdatas[r]}}restimes=restimes.replace(/:/gi,"_key_");for(var k=1;k<=room_cnt;k++){subcontent+="<tr>";if(room_title==""){subcontent+="<th class=\"tit\">"+roomnames[k]+" ["+roomnames_maxs[k]+"]</th>"}var timekey=start_time-1;var sethref_class="";var roomchk=true;var cellnum=1;for(var kd=parseInt(start_time);kd<parseInt(half_time_cnt)+parseInt(start_time);kd++){timekey=parseInt(timekey)+1;var msg;var msg2;var roomkey=roomcodes[k]+"_key_"+timekey;var set_hours=timekey;var set_hour=set_hours;var timekey2=0;var subtime=new Date(selday.getFullYear(),(selday.getMonth()),selday.getDate(),set_hour);var current_time=new Date(today.getFullYear(),(today.getMonth()+1),today.getDate(),today.getHours());var current_cell=current_hour;if((parseInt(subtime.valueOf())-parseInt(current_time.valueOf()))==0){timekey2=parseInt(today.getHours())}if(subtime.valueOf()<current_time.valueOf()){sethref_class=""}else{sethref_class=""}if(timekey==current_cell){sethref_class=""}if(timekey2>0){unchecknum=(parseInt(timekey2)-parseInt(start_time)+1)}if(cellnum<=unchecknum){sethref_class=""}if(restimes.indexOf(roomkey)!=-1){sethref_class="on";if(subtime.valueOf()<current_time.valueOf()){sethref_class="off"}}var roomkey_arr=roomkey.split("_key_");var roomkey_room=roomkey_arr[0];var roomkey_seltime=roomkey_arr[1];subcontent+="<td><span id=\"tag"+roomkey+"\" class=\""+sethref_class+"\" ></span></td>";cellnum++}subcontent+="</tr>"}footcontent="<div class=\"btn\" id=\"pageNavi\"></div>";var tableHtmlArr=["<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">"];for(var row=0;row<1;row++){tableHtmlArr.push(subcontent)}tableHtmlArr.push("</table>");tableHtmlArr.push(footcontent);maincontent=tableHtmlArr.join("");return maincontent},getRoomShow:function(page){if($("#resdate").val()){$.getReserver($("#resdate").val(),page)}else{var current=leadingZeros(today.getFullYear(),4)+"-"+leadingZeros((today.getMonth()+1),2)+"-"+leadingZeros(today.getDate(),2);$("#currentday").text(leadingZeros((today.getMonth()+1),2)+"월 "+leadingZeros(today.getDate(),2)+"일");$("#resdate").val(current);$.getReserver(current,page)}}});$.getRoomShow();jQuery(".naviPage").live("click",function(){var page=$(this).attr('pageNo');_PAGE=page;$.getRoomShow(page)})})});