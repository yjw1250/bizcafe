function leadingZeros(n,digits){var zero='';n=n.toString();if(n.length<digits){for(i=0;i<digits-n.length;i++)zero+='0'}return zero+n}function returntime(timestamp){var time=new Date(timestamp);return time}function numberFormat(num){var pattern=/(-?[0-9]+)([0-9]{3})/;while(pattern.test(num)){num=num.replace(pattern,"$1,$2")}return num}$(document).ready(function(){var today=new Date();var current_hour=today.getHours();var current_min=today.getMinutes();$(function(){$.extend({linkroom:function(roomkey_room){if(roomkey_room.substr(0,4)=="AP01"){location.href="/guide/business/space?type=0"}else if(roomkey_room.substr(0,4)=="AM01"){location.href="/guide/business/space?type=1"}else if(roomkey_room.substr(0,4)=="AS01"){location.href="/guide/business/space?type=2"}else if(roomkey_room.substr(0,6)=="AS0201"){location.href="/guide/business/space?type=3"}else if(roomkey_room.substr(0,6)=="AS0202"){location.href="/guide/business/space?type=4"}else if(roomkey_room.substr(0,6)=="AC0101"||roomkey_room.substr(0,6)=="AC0102"){location.href="/guide/business/space?type=5"}else if(roomkey_room.substr(0,6)=="AC0103"){location.href="/guide/business/space?type=6"}else if(roomkey_room.substr(0,4)=="AC02"){location.href="/guide/business/space?type=7"}},getRoomKey:function(obj,value,findkey){var returnKey=-1;$.each(obj,function(key,info){if(info.room_order_number==value){returnKey=key-findkey;return false}});if(obj[returnKey]==undefined){returnKey=-1}return returnKey},getDate:function(date,val){var getdate=date.split("-");var syear=getdate[0];var smonth=parseInt(getdate[1]-1,10);var sdate=parseInt(getdate[2],10);var setdate=new Date(syear,smonth,sdate+parseInt(val,10));var DateString=leadingZeros(setdate.getFullYear(),4)+"-"+leadingZeros((setdate.getMonth()+1),2)+"-"+leadingZeros(setdate.getDate(),2);return DateString},deleteItemByIdRoomKey:function(idroomkey){if((timedata==null||timedata.length==0)&&idroomkey)return;var newTimeData=[];for(var i=0;i<timedata.length;i++){if(timedata[i].idroomkey==idroomkey)continue;newTimeData.push(timedata[i])}timedata=newTimeData},booking_display:function(start_time,end_time,sel_time,room_cnt,room_title,roomcode,room_name,room_name_max,addroom,admin,jsondata){var half_time_cnt=((end_time-start_time)+1)*2;var colspans=half_time_cnt+2;var currentday=new Date(today.getFullYear(),(today.getMonth()+1),today.getDate());var seldays=sel_time.split("-");var selday=new Date(seldays[0],(seldays[1]-1),seldays[2]);var maincontent;var subcontent;var footcontent;var timestr;var setclass="";var unchecknum=0;var resdata="";for(var key in jsondata.reserver){if(jsondata.reserver[key].resDate==sel_time){resdata=resdata+","+jsondata.reserver[key].resRoom}}var resdatas=resdata.split(",");var restimes="";for(r=0;r<resdatas.length;r++){if(resdatas[r]){restimes=restimes+","+resdatas[r]}}restimes=restimes.replace(/:/gi,"_key_");subcontent="<colgroup>";subcontent+="<col width=\"66px\"><col width=\"62px\">";subcontent+="<col width=\"\" colspan=\""+colspans+"\">";subcontent+="<col width=\"*\"></colgroup>";subcontent+="<thead><tr>";subcontent+="<th colspan=\"2\" class=\"booth\"  scope=\"col\">&nbsp;</th>";for(var i=parseInt(start_time,10);i<=parseInt(end_time,10);i++){timestr=i.toString();if(timestr.length==1){timestr="0"+timestr}var idkey="res-"+timestr;if(currentday.valueOf()==selday.valueOf()){if(timestr==current_hour){setclass="ontime"}else{setclass=""}}else{setclass=""}subcontent+="<th id=\""+idkey+"\" colspan=\"2\" scope=\"col\" class="+setclass+">"+timestr+"</th>"}if(admin!="2"){subcontent+="<th scope=\"col\">상세정보</th>"}subcontent+="</thead>";subcontent+="</tr>";subcontent+="<tbody>";var roomnames;if(room_name.length>=1){roomnames=room_name.split(",")}var roomnames_maxs;if(room_name_max.length>=1){roomnames_maxs=room_name_max.split(",")}var roomcodes;if(roomcode.length>=1){roomcodes=roomcode.split(",")}for(var k=1;k<=room_cnt;k++){subcontent+="<tr>";if(room_title==""){if(admin=="2"){}subcontent+="<th class=\"th3\" colspan=\"2\">"+roomnames[k]+"<br>["+roomnames_maxs[k]+"]</th>"}else{if(k==1){subcontent+="<th class=\"th2\" rowspan=\""+room_cnt+"\" scope=\"row\">"+room_title+"</th>"}subcontent+="<th class=\"th3\">"+roomnames[k]+"<br>["+roomnames_maxs[k]+"]</th>"}var timekey=start_time-1;var settd_class="range";var sethref_class="select";var setblind_txt="공실";var roomchk=true;var cellnum=1;for(var kd=parseInt(start_time);kd<parseInt(half_time_cnt)+parseInt(start_time);kd++){if(kd/2%1==0){timekey=(parseInt(timekey)+1)+"-1"}else if(kd/2%1==0.5){timekey=parseInt(timekey)+"-2"}var msg;var msg2;var roomkey=roomcodes[k]+"_key_"+timekey;var set_hours=timekey.split('-');var set_hour=set_hours[0];var subtime=new Date(selday.getFullYear(),(selday.getMonth()+1),selday.getDate(),set_hour);var current_time=new Date(today.getFullYear(),(today.getMonth()+1),today.getDate(),today.getHours());var now_time=new Date(today.getFullYear(),(today.getMonth()+1),today.getDate(),today.getHours(),today.getMinutes());var now_chk_val=-1;var now_chk_sel=0;var timekey2="";var timekey2_arr="";var timekey_arr="";var cell_time_range1=new Date(selday.getFullYear(),(selday.getMonth()+1),selday.getDate(),set_hour,0);var cell_time_range2=new Date(selday.getFullYear(),(selday.getMonth()+1),selday.getDate(),set_hour,29);var cell_time_range3=new Date(selday.getFullYear(),(selday.getMonth()+1),selday.getDate(),set_hour,30);var cell_time_range4=new Date(selday.getFullYear(),(selday.getMonth()+1),selday.getDate(),set_hour,59);if(parseInt(now_time.valueOf())<=parseInt(cell_time_range2.valueOf())&&parseInt(now_time.valueOf())>=parseInt(cell_time_range1.valueOf())){now_chk_sel=1}else if(parseInt(now_time.valueOf())<=parseInt(cell_time_range4.valueOf())&&parseInt(now_time.valueOf())>=parseInt(cell_time_range3.valueOf())){now_chk_sel=2}var current_cell=current_hour+"-"+now_chk_sel;if((parseInt(subtime.valueOf())-parseInt(current_time.valueOf()))==0){var chktimes=timekey.split("-");if((parseInt(now_time.getMinutes())-11)<0&&(parseInt(now_time.getMinutes())-41)<0){timekey2=(parseInt(today.getHours())+1)+"-1"}else if((parseInt(now_time.getMinutes())-11)>=0&&(parseInt(now_time.getMinutes())-41)<0){timekey2=(parseInt(today.getHours())+1)+"-2"}else if((parseInt(now_time.getMinutes())-11)>=0&&(parseInt(now_time.getMinutes())-41)>=0){timekey2=(parseInt(today.getHours())+2)+"-1"}}if(timekey==current_cell){settd_class="ontime";sethref_class="select";msg="공실";msg2="공실입니다";roomchk=1}if(admin>=1){if(subtime.valueOf()<current_time.valueOf()){settd_class="range";sethref_class="select";msg="공실";msg2="공실입니다";roomchk=1;var adminselday=new Date(seldays[0],seldays[1],seldays[2]);if(adminselday.valueOf()<currentday.valueOf()){settd_class="rangeOut";sethref_class="select";msg="공실";msg2="이전 날짜는 예약 및 수정 하실수 없습니다";roomchk=0}}else{settd_class="range";sethref_class="select";msg="공실";msg2="공실입니다";roomchk=1}if(timekey2!=""){timekey2_arr=timekey2.split("-");if(timekey2_arr.length>=1){unchecknum=(parseInt(timekey2_arr[0])-parseInt(start_time))*2;unchecknum=unchecknum+parseInt(timekey2_arr[1])-1}}if(cellnum<=unchecknum){if(timekey==current_cell){settd_class="ontime";sethref_class="selectOut";msg="공실";msg2="관리자는 선택 가능합니다";roomchk=1}else{settd_class="range";sethref_class="select";msg="공실";msg2="관리자는 선택 가능합니다";roomchk=1}}}else{if(subtime.valueOf()<current_time.valueOf()){settd_class="rangeOut";sethref_class="select";msg="공실";msg2="선택하신 시간은  예약하실수 없습니다";roomchk=0}else{settd_class="range";sethref_class="select";msg="공실";msg2="공실입니다";roomchk=1}if(timekey2!=""){timekey2_arr=timekey2.split("-");if(timekey2_arr.length>=1){unchecknum=(parseInt(timekey2_arr[0])-parseInt(start_time))*2;unchecknum=unchecknum+parseInt(timekey2_arr[1])-1}}if(cellnum<=unchecknum){if(timekey==current_cell){settd_class="ontime";sethref_class="selectOut";msg="공실";msg2="선택하신 시간은  예약하실수 없습니다";roomchk=0}else{settd_class="rangeOut";sethref_class="select";msg="공실";msg2="선택하신 시간은  예약하실수 없습니다";roomchk=0}}}if(restimes.indexOf(roomkey)!=-1){settd_class="rangeOut";sethref_class="selectOut";msg="이용완료";msg2="선택하신 시간은  예약하실수 없습니다";roomchk=0;if(timekey==current_cell){}}if(cellnum%2==0){settd_class=settd_class+" td2"}else{settd_class=settd_class+" td1"}setblind_txt=msg;var roomkey_arr=roomkey.split("_key_");var roomkey_room=roomkey_arr[0];var roomkey_seltime=roomkey_arr[1];if(admin!="2"){subcontent+="<td class=\""+settd_class+"\" id="+roomkey+"><a href=\"javascript:$.click_resdate('"+sel_time+"','"+roomkey+"','"+roomkey_room+"','"+roomkey_seltime+"','"+cellnum+"',"+roomchk+",'"+msg2+"');\" id=\"tag"+roomkey+"\" class=\""+sethref_class+"\" style=\"cursor:pointer\"><span class=\"blind\">"+setblind_txt+"</span></a></td>"}else{subcontent+="<td class=\""+settd_class+"\" id="+roomkey+"><a href=\"javascript:;\" id=\"tag"+roomkey+"\" class=\""+sethref_class+"\" style=\"cursor:pointer\"><span class=\"blind\">"+setblind_txt+"</span></a></td>"}cellnum++}if(admin!="2"){subcontent+="<td class=\"detail\"><a href=\"javascript:$.linkroom('"+roomkey_room+"');\"><img src=\"/public/images/booking/btn_detail_veiw.gif\" alt=\"상세\"></a></td>"}subcontent+="</tr>"}if(admin!="2"){footcontent="<div class=\"tbl_bookingIn\">";footcontent+="<dl>";footcontent+="<dt>예약시간</dt>";footcontent+="<dd>";footcontent+="<input type=\"text\" style=\"ime-mode:active;width:100px\" value=\"\" name=\"starttime\" id=\"starttime\" class=\"input_txt\"  readOnly>";footcontent+="~<input type=\"text\" style=\"ime-mode:active;width:100px\" value=\"\" name=\"endtime\" id=\"endtime\" class=\"input_txt\"  readOnly>";footcontent+="<span class=\"note_attach\">* 위의 표에서 선택하시면 자동 입력됩니다.</span>";footcontent+="</dd>";footcontent+="</dl>";footcontent+="</div>";footcontent+="<div class=\"booking_expn\">";footcontent+="<p>* 1인실은 기본 1시간, 2인실 이상은 기본 2시간 이상 선택 필수.</p>";footcontent+="</div>"}var tableHtmlArr=["<table cellspacing=\"0\" border=\"1\" summary=\"예약테이블\">"];for(var row=0;row<1;row++){tableHtmlArr.push(subcontent)}tableHtmlArr.push("</TABLE>");tableHtmlArr.push(footcontent);maincontent=tableHtmlArr.join("");return maincontent}})})});